<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cloudflare Analytics Pipeline</title>
  <script src="beacon.min.js"></script>
  <script src="exp-beacon.min.js"></script>
  <script>
    // Initialize Beacon for this documentation page
    document.addEventListener('DOMContentLoaded', function() {
      if (window.Beacon) {
        Beacon.init({
          endpoint: window.location.origin,
          siteId: 'beacon-docs',
          debug: true,
          trackClicks: true,
          respectDoNotTrack: false,
          trackUserTimings: true
        });

        if (window.BeaconExperiments) {
          BeaconExperiments.init({
            debug: true
          });

          BeaconExperiments.defineExperiments([
            {
              id: 'color_scheme',
              name: 'Documentation Color Scheme',
              description: 'Testing different color schemes for documentation readability',
              active: true,
              autoActivate: true,
              variants: [
                {
                  id: 'control',
                  name: 'Default Theme',
                  weight: 50,
                  activate: function() {
                    document.documentElement.style.setProperty('--bg-color', '#ffffff');
                    document.documentElement.style.setProperty('--text-color', '#333333');
                    document.documentElement.style.setProperty('--heading-color', '#2563eb');
                    document.documentElement.style.setProperty('--border-color', '#e5e7eb');
                  }
                },
                {
                  id: 'dark',
                  name: 'Dark Theme',
                  weight: 50,
                  activate: function() {
                    document.documentElement.style.setProperty('--bg-color', '#1a1a1a');
                    document.documentElement.style.setProperty('--text-color', '#e5e7eb');
                    document.documentElement.style.setProperty('--heading-color', '#60a5fa');
                    document.documentElement.style.setProperty('--border-color', '#374151');
                    document.documentElement.style.setProperty('--code-bg', '#2d3748');
                    document.documentElement.style.setProperty('--code-text', '#e2e8f0');
                  }
                }
              ]
            }
          ]);

          BeaconExperiments.activateAll();

          const controlPanel = document.createElement('div');
          controlPanel.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: var(--bg-color); border: 1px solid var(--border-color); padding: 10px; border-radius: 6px; z-index: 1000;';
          
          const title = document.createElement('div');
          title.textContent = 'Experiment Controls';
          title.style.cssText = 'font-weight: bold; margin-bottom: 8px; color: var(--heading-color);';
          controlPanel.appendChild(title);

          const buttonContainer = document.createElement('div');
          buttonContainer.style.cssText = 'display: flex; gap: 8px;';

          ['control', 'dark'].forEach(variant => {
            const button = document.createElement('button');
            button.textContent = variant === 'control' ? 'Light Theme' : 'Dark Theme';
            button.style.cssText = `
              padding: 6px 12px;
              border: 1px solid var(--border-color);
              border-radius: 4px;
              background: var(--bg-color);
              color: var(--text-color);
              cursor: pointer;
              transition: all 0.2s ease;
            `;
            button.onmouseover = () => button.style.background = 'var(--border-color)';
            button.onmouseout = () => button.style.background = 'var(--bg-color)';
            
            button.onclick = () => {
              BeaconExperiments.forceVariant('color_scheme', variant);
              Beacon.trackEvent({
                name: 'experiment_force',
                category: 'experiments',
                label: 'color_scheme',
                value: variant
              });
              setTimeout(() => window.location.reload(), 100);
            };
            
            buttonContainer.appendChild(button);
          });

          controlPanel.appendChild(buttonContainer);
          document.body.appendChild(controlPanel);
        }

        document.querySelectorAll('pre code').forEach(function(codeBlock) {
          codeBlock.addEventListener('click', function() {
            Beacon.trackEvent({
              name: 'code_click',
              category: 'docs',
              label: this.parentElement.previousElementSibling?.textContent || 'unknown_section'
            });
          });
        });

        document.querySelectorAll('pre code').forEach(function(codeBlock) {
          codeBlock.addEventListener('copy', function() {
            Beacon.trackEvent({
              name: 'code_copy',
              category: 'docs',
              label: this.parentElement.previousElementSibling?.textContent || 'unknown_section'
            });
          });
        });
      }
    });
  </script>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --heading-color: #2563eb;
      --border-color: #e5e7eb;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
      color: var(--text-color);
      background-color: var(--bg-color);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    h1 {
      color: var(--heading-color);
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 0.5rem;
    }

    h2 {
      color: var(--heading-color);
      margin-top: 2rem;
    }

    pre {
      background: var(--code-bg, #f8fafc);
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      color: var(--code-text, inherit);
    }

    code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.9em;
      color: var(--code-text, inherit);
    }

    ul {
      padding-left: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;
    }

    strong {
      color: var(--heading-color);
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <h1>Analytics Pipeline</h1>
  <p>There's no dashboard for this project just yet.</p>
  <p>To track events, use the following code:</p>

  <h2>Installation</h2>
  <p>Include the script in your HTML:</p>
  <pre><code>&lt;script src="https://beacon.nickgriffin.uk/beacon.js"&gt;&lt;/script&gt;</code></pre>

  <h2>Configuration Options</h2>
  <ul>
    <li><strong>endpoint</strong>: API endpoint URL (default: https://beacon.nickgriffin.uk)</li>
    <li><strong>siteId</strong>: Your site's unique identifier (required)</li>
    <li><strong>debug</strong>: Enable console logging (default: false)</li>
    <li><strong>trackPageViews</strong>: Automatically track page views (default: true)</li>
    <li><strong>trackClicks</strong>: Automatically track link clicks (default: false)</li>
    <li><strong>trackUserTimings</strong>: Track page performance metrics (default: false)</li>
    <li><strong>batchSize</strong>: Number of events to send in a batch (default: 10)</li>
    <li><strong>batchTimeout</strong>: Time in ms before sending partial batch (default: 5000)</li>
    <li><strong>directPageViews</strong>: Send page views immediately instead of batching (default: true)</li>
    <li><strong>requireConsent</strong>: Require user consent before tracking (default: false)</li>
    <li><strong>respectDoNotTrack</strong>: Respect browser Do Not Track setting (default: true)</li>
    <li><strong>consentCookie</strong>: Name of the cookie used to store consent (default: 'beacon_consent')</li>
    <li><strong>appName</strong>: Name of your application (defaults to document.title)</li>
  </ul>

  <pre>
    <code>
      &lt;script&gt;
        // Demo initialization
        document.addEventListener('DOMContentLoaded', function () {
          if (window.Beacon) {
            Beacon.init({
              siteId: 'demo-site',
              debug: true
            });
          }
        });
      &lt;/script&gt;
    </code>
  </pre>

  <h2>Usage</h2>
  <pre><code>// Initialize Beacon with your site ID
Beacon.init({
  siteId: 'YOUR_SITE_ID',
  debug: true, // Set to false in production
  trackClicks: true, // Optional: automatically track link clicks
  trackUserTimings: true // Optional: track page performance metrics
});

// Track custom events
Beacon.trackEvent({
  name: 'event_name',
  category: 'category_name',
  label: 'optional_label',
  value: 'optional_value'
});

// Manually track a page view (happens automatically with trackPageViews: true)
Beacon.trackPageView();</code></pre>

  <h2>Experiments</h2>
  <p>Beacon includes an experiments module for A/B testing and feature flagging. Here's how to use it:</p>

  <h3>Initialization</h3>
  <pre><code>// Initialize Beacon first
Beacon.init({
  siteId: 'YOUR_SITE_ID',
  endpoint: 'https://beacon.nickgriffin.uk',
  debug: true
});

// Initialize the experiments module
BeaconExperiments.init({
  debug: true
});</code></pre>

  <h3>Defining Experiments</h3>
  <pre><code>BeaconExperiments.defineExperiments([
  {
    id: 'experiment_id',
    name: 'Experiment Name',
    description: 'Description of what we're testing',
    active: true,
    autoActivate: true,
    // Optional targeting function
    targeting: function() {
      return window.location.pathname === '/';
    },
    variants: [
      {
        id: 'control',
        name: 'Control Variant',
        weight: 50, // Percentage of traffic
        activate: function() {
          // Control variant implementation
        }
      },
      {
        id: 'variant_a',
        name: 'Variant A',
        weight: 50,
        activate: function() {
          // Variant A implementation
        }
      }
    ]
  }
]);</code></pre>

  <h3>Activating Experiments</h3>
  <pre><code>// Activate all targeted experiments
BeaconExperiments.activateAll();

// Or activate a specific experiment
BeaconExperiments.activate('experiment_id');</code></pre>

  <h3>Tracking Conversions</h3>
  <pre><code>// Track a conversion for an experiment
BeaconExperiments.trackConversion('experiment_id', 'conversion_name');</code></pre>

  <h3>Checking Variants</h3>
  <pre><code>// Check if user is in a specific variant
if (BeaconExperiments.isInVariant('experiment_id', 'variant_id')) {
  // Variant-specific code
}</code></pre>

  <h3>Debugging</h3>
  <p>The following helper functions are available when debug mode is enabled:</p>
  <ul>
    <li><code>BeaconExperiments.forceVariant(experimentId, variantId)</code> - Force a specific variant</li>
    <li><code>BeaconExperiments.resetAssignments()</code> - Reset all experiment assignments</li>
    <li><code>BeaconExperiments.getExperiments()</code> - Get all defined experiments</li>
  </ul>

  <h3>Complete Example</h3>
  <pre><code>// Initialize both modules
Beacon.init({
  siteId: 'YOUR_SITE_ID',
  endpoint: 'https://beacon.nickgriffin.uk',
  debug: true
});

BeaconExperiments.init({
  debug: true
});

// Define a homepage hero test
BeaconExperiments.defineExperiments([
  {
    id: 'home_hero_test',
    name: 'Homepage Hero Variant Test',
    description: 'Testing different hero section designs',
    active: true,
    autoActivate: true,
    targeting: function() {
      return window.location.pathname === '/';
    },
    variants: [
      {
        id: 'control',
        name: 'Current Design',
        weight: 50,
        activate: function() {
          // Control implementation
        }
      },
      {
        id: 'variant_a',
        name: 'New Design',
        weight: 50,
        activate: function() {
          // New design implementation
        }
      }
    ]
  }
]);

// Activate experiments
BeaconExperiments.activateAll();

// Track conversions
document.querySelector('#signup-button').addEventListener('click', function() {
  BeaconExperiments.trackConversion('home_hero_test', 'signup_click');
});</code></pre>

</body>

</html>